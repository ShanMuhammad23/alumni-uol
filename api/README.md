# Newsletters API Setup

This API endpoint fetches newsletters from the PostgreSQL database and serves them to the frontend.

## Database Setup

1. Run the SQL schema to create the `newsletters` table:
```sql
create table public.newsletters (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  title text null,
  date date null,
  image text null,
  link text null,
  constraint newsletters_pkey primary key (id)
) TABLESPACE pg_default;
```

2. Insert sample data:
```sql
INSERT INTO public.newsletters (title, date, image, link) VALUES
  ('Alumni Newsletter', '2025-09-01', '/assets/img/banner/newsletter.jpg', 'https://sites.uol.edu.pk/newsletter/alumni/sept2025/');
```

## Installation

1. Install dependencies:
```bash
npm install
```

2. Set up environment variables:
   - Create a `.env` file or set `DATABASE_URL` environment variable
   - Format: `postgresql://username:password@host:port/database`

## Running the API

### Option 1: Standalone Express Server

Run the API as a standalone server:
```bash
npm start
```

The API will be available at `http://localhost:3001/api/newsletters`

### Option 2: Serverless Function (Vercel/Netlify)

For Vercel, create `vercel.json`:
```json
{
  "functions": {
    "api/newsletters.js": {
      "runtime": "nodejs18.x"
    }
  }
}
```

For Netlify, create `netlify.toml`:
```toml
[build]
  functions = "api"
```

### Option 3: Express Middleware

If you have an existing Express app, import the handler:
```javascript
const newslettersHandler = require('./api/newsletters');
app.get('/api/newsletters', newslettersHandler);
```

## API Response Format

The API returns an array of newsletter objects:
```json
[
  {
    "id": "1",
    "title": "Alumni Newsletter",
    "issue": "September 2025",
    "releaseDate": "2025-09-01",
    "summary": "Stay connected with the latest updates...",
    "cover": "/assets/img/banner/newsletter.jpg",
    "pdf": "https://sites.uol.edu.pk/newsletter/alumni/sept2025/",
    "year": 2025,
    "categories": ["Alumni", "News"]
  }
]
```

## Frontend Configuration

Update the API URL in `newsletters/index.html`:
```javascript
const API_URL = '/api/newsletters';  // Update this to match your API endpoint
```

If your API is on a different domain, update the URL accordingly:
```javascript
const API_URL = 'https://your-api-domain.com/api/newsletters';
```

## Environment Variables

- `DATABASE_URL`: PostgreSQL connection string (required)
- `NODE_ENV`: Set to `production` for SSL connections (optional)
- `PORT`: Server port (default: 3001)

## Troubleshooting

1. **Connection errors**: Verify your `DATABASE_URL` is correct
2. **CORS issues**: The API includes CORS headers, but ensure your frontend domain is allowed
3. **Empty results**: Check that data exists in the `newsletters` table

